# Software Requirements Specification (SRS)
# منصة Dueli - متطلبات النظام التقنية

## 1. المتطلبات الوظيفية (Functional Requirements)

### FR-1: نظام إدارة المستخدمين (User Management System)

#### FR-1.1: التسجيل والمصادقة
**FR-1.1.1** يجب أن يتمكن المستخدم من إنشاء حساب جديد باستخدام بريد إلكتروني وكلمة مرور
- **معايير القبول:**
  - البريد الإلكتروني يجب أن يكون صالحاً وفريداً في النظام
  - كلمة المرور يجب أن تكون 8 أحرف على الأقل
  - رسالة تفعيل تُرسل للبريد خلال 60 ثانية
  - الحساب يبقى غير مفعّل حتى النقر على رابط التفعيل
- **أولوية:** عالية
- **الاختبار:** يمكن اختبار إنشاء حساب جديد والتحقق من إرسال البريد

**FR-1.1.2** يجب أن يتمكن المستخدم من تسجيل الدخول عبر OAuth
- **معايير القبول:**
  - دعم Google OAuth 2.0
  - دعم Microsoft OAuth 2.0
  - دعم Facebook Login
  - إنشاء حساب تلقائي عند أول تسجيل دخول
  - ربط البريد الإلكتروني من مزود OAuth بالحساب
- **أولوية:** عالية
- **الاختبار:** محاولة تسجيل الدخول بكل مزود والتحقق من إنشاء الحساب

**FR-1.1.3** يجب أن يتمكن المستخدم من استعادة كلمة المرور
- **معايير القبول:**
  - إرسال رابط استعادة للبريد المسجل
  - الرابط صالح لمدة 24 ساعة فقط
  - استخدام الرابط مرة واحدة فقط
  - إرسال إشعار بريدي عند تغيير كلمة المرور بنجاح
- **أولوية:** متوسطة
- **الاختبار:** طلب استعادة وتغيير كلمة المرور والتحقق من الإشعارات

**FR-1.1.4** يجب أن يتمكن المستخدم المسجل من تعديل كلمة المرور
- **معايير القبول:**
  - يجب إدخال كلمة المرور الحالية أولاً
  - كلمة المرور الجديدة يجب أن تكون مختلفة عن القديمة
  - إرسال إشعار بريدي عند التغيير
  - تسجيل خروج تلقائي من كل الأجهزة الأخرى
- **أولوية:** متوسطة
- **الاختبار:** تعديل كلمة المرور والتحقق من تسجيل الخروج

#### FR-1.2: الملف الشخصي
**FR-1.2.1** يجب أن يتمكن المستخدم من تعديل معلوماته الشخصية
- **معايير القبول:**
  - تعديل الاسم (2-100 حرف)
  - رفع صورة شخصية (max 5MB, PNG/JPG/WebP)
  - كتابة نبذة (max 500 حرف)
  - اختيار القسم المفضل
  - حفظ التعديلات فوراً
- **أولوية:** عالية
- **الاختبار:** تعديل كل حقل والتحقق من الحفظ

**FR-1.2.2** يجب أن يتمكن المستخدم من ضبط إعدادات الخصوصية
- **معايير القبول:**
  - اختيار عرض البريد (عام/خاص)
  - اختيار عرض رقم الهاتف إن وُجد (عام/خاص)
  - اختيار عرض المنافسات السابقة (عام/خاص)
  - اختيار من يستطيع مراسلته (الجميع/المتابَعين فقط/لا أحد)
- **أولوية:** متوسطة
- **الاختبار:** تغيير كل إعداد والتحقق من تطبيقه

**FR-1.2.3** يجب عرض إحصائيات المستخدم في ملفه الشخصي
- **معايير القبول:**
  - عدد المنافسات الإجمالي
  - عدد المنافسات كـ Host
  - عدد المنافسات كـ Guest
  - متوسط التقييم (من 100)
  - إجمالي النقاط المكتسبة
  - عدد المتابعين
  - عدد المتابَعين
  - تحديث فوري عند أي تغيير
- **أولوية:** متوسطة
- **الاختبار:** فتح الملف الشخصي والتحقق من دقة الإحصائيات

#### FR-1.3: التواصل بين المستخدمين
**FR-1.3.1** يجب توفر صندوق رسائل للمراسلات الخاصة
- **معايير القبول:**
  - إرسال رسالة نصية (max 2000 حرف)
  - إرفاق صورة (max 5MB)
  - إشعار فوري للمستقبِل
  - ترتيب المحادثات حسب الأحدث
  - عرض حالة القراءة (مُقرأ/غير مُقرأ)
  - إمكانية حذف الرسائل من الطرفين
- **أولوية:** عالية
- **الاختبار:** إرسال رسائل بين مستخدمين والتحقق من الإشعارات

**FR-1.3.2** يجب توفر نظام إشعارات شامل
- **معايير القبول:**
  - إشعار عند طلب انضمام لمنافسة
  - إشعار عند قبول/رفض طلب
  - إشعار قبل بدء منافسة مجدولة (15 دقيقة)
  - إشعار عند رسالة جديدة
  - إشعار عند تعليق على منافسة شاركت فيها
  - إشعار عند متابعة جديدة
  - عرض عدد الإشعارات غير المقروءة
  - إمكانية تعطيل أنواع معينة من الإشعارات
- **أولوية:** عالية
- **الاختبار:** محاكاة كل حدث والتحقق من ظهور الإشعار

**FR-1.3.3** يجب أن يتمكن المستخدم من متابعة مستخدمين آخرين
- **معايير القبول:**
  - زر "متابعة" في ملف المستخدم
  - إشعار للمتابَع عند المتابعة
  - عرض قائمة المتابعين والمتابَعين
  - إمكانية إلغاء المتابعة
  - إشعار عند فتح المتابَع لمنافسة جديدة
- **أولوية:** متوسطة
- **الاختبار:** متابعة مستخدم والتحقق من الإشعارات

---

### FR-2: نظام المنافسات (Competition System)

#### FR-2.1: إنشاء منافسة (Host)
**FR-2.1.1** يجب أن يتمكن المستخدم المسجل من إنشاء منافسة جديدة
- **معايير القبول:**
  - اختيار قسم من قائمة محددة (نزاع، علم، موهبة، عام، سياسة، دين، إلخ)
  - إدخال عنوان المنافسة (10-200 حرف)
  - إدخال وصف (50-2000 حرف)
  - وضع قواعد وشروط (اختياري، max 1000 حرف)
  - اختيار نوع الوقت (فوري/مجدول)
  - إذا مجدول: تحديد تاريخ ووقت (لا يقل عن ساعة من الآن)
  - تحديد مدة متوقعة (15-120 دقيقة)
  - حفظ المنافسة بحالة "Pending"
- **أولوية:** حرجة
- **الاختبار:** إنشاء منافسة بكل الخيارات والتحقق من الحفظ

**FR-2.1.2** يجب أن تظهر المنافسة المفتوحة في قائمة المنافسات المتاحة
- **معايير القبول:**
  - ظهور فوري بعد الإنشاء
  - عرض: العنوان، القسم، الوصف، اسم الـ Host، عدد الطلبات
  - فلترة حسب القسم
  - ترتيب حسب (الأحدث، الأكثر طلبات، الأقرب للبدء)
  - ظهور للمستخدمين المسجلين فقط
- **أولوية:** حرجة
- **الاختبار:** إنشاء منافسة والبحث عنها في القائمة

**FR-2.1.3** يجب أن يتمكن الـ Host من إرسال دعوات مباشرة
- **معايير القبول:**
  - عرض قائمة بكل المستخدمين
  - فلترة حسب (القسم المفضل، متوسط التقييم، عدد المنافسات)
  - إرسال دعوة لمستخدم واحد أو أكثر
  - تسجيل الدعوة في "طلباتي المُرسلة"
  - إشعار فوري للمدعو
  - إمكانية إلغاء الدعوة قبل القبول
- **أولوية:** متوسطة
- **الاختبار:** إرسال دعوة والتحقق من استلام الإشعار

#### FR-2.2: التقديم على منافسة (Guest)
**FR-2.2.1** يجب أن يتمكن المستخدم من التقديم على منافسة مفتوحة
- **معايير القبول:**
  - زر "تقديم طلب" في صفحة المنافسة
  - إدخال رسالة للـ Host (اختياري، max 500 حرف)
  - إرسال الطلب
  - تسجيل في "طلباتي المُرسلة"
  - إشعار فوري للـ Host
  - عرض حالة الطلب (معلق/مقبول/مرفوض)
- **أولوية:** حرجة
- **الاختبار:** تقديم طلب والتحقق من إرساله للـ Host

**FR-2.2.2** يجب أن يتمكن Guest من حذف طلبه قبل القبول
- **معايير القبول:**
  - زر "حذف الطلب" في قائمة طلباتي
  - تأكيد قبل الحذف
  - إزالة من قائمة طلبات الـ Host
  - إشعار للـ Host بالحذف
- **أولوية:** منخفضة
- **الاختبار:** حذف طلب والتحقق من اختفائه

**FR-2.2.3** يجب إشعار Guest عند قبول أو رفض طلبه
- **معايير القبول:**
  - إشعار فوري عند قبول
  - إشعار فوري عند رفض
  - عرض السبب إن وُجد (للرفض)
  - تحديث حالة الطلب في قائمتي
- **أولوية:** عالية
- **الاختبار:** قبول/رفض طلب والتحقق من الإشعار

#### FR-2.3: إدارة الطلبات (Host)
**FR-2.3.1** يجب أن يستقبل الـ Host إشعار عند كل طلب جديد
- **معايير القبول:**
  - إشعار فوري
  - عرض اسم المتقدم ورسالته
  - رابط مباشر للملف الشخصي للمتقدم
  - عرض الطلب في قائمة "طلبات منافساتي"
- **أولوية:** حرجة
- **الاختبار:** تقديم طلب والتحقق من استلام الـ Host

**FR-2.3.2** يجب أن يتمكن الـ Host من قبول طلب واحد فقط
- **معايير القبول:**
  - زر "قبول" لكل طلب
  - عند القبول:
    - تغيير حالة المنافسة من "Pending" إلى "Scheduled" أو "Ready"
    - حذف كل الطلبات الأخرى تلقائياً
    - إشعار للـ Guest المقبول
    - إشعار لكل المتقدمين الآخرين بالرفض
    - إزالة المنافسة من القائمة المفتوحة
  - إذا كانت المنافسة مجدولة:
    - إضافة للتقويم
    - إشعار قبل البدء بـ 15 دقيقة للطرفين
- **أولوية:** حرجة
- **الاختبار:** قبول طلب والتحقق من حذف البقية

**FR-2.3.3** يجب أن يتمكن الـ Host من رفض طلب
- **معايير القبول:**
  - زر "رفض" لكل طلب
  - إدخال سبب الرفض (اختياري، max 200 حرف)
  - إشعار للمتقدم بالرفض
  - إزالة الطلب من القائمة
  - المنافسة تبقى مفتوحة
- **أولوية:** متوسطة
- **الاختبار:** رفض طلب والتحقق من الإشعار

**FR-2.3.4** يجب أن يتمكن الـ Host من حذف المنافسة قبل القبول
- **معايير القبول:**
  - زر "حذف المنافسة"
  - تأكيد قبل الحذف
  - إشعار لكل المتقدمين بالحذف
  - إزالة من كل القوائم
- **أولوية:** منخفضة
- **الاختبار:** حذف منافسة والتحقق من الإشعارات

#### FR-2.4: حالات المنافسة
**FR-2.4.1** يجب أن تتحول المنافسة عبر حالات محددة
- **معايير القبول:**
  - **Pending:** بعد الإنشاء، في انتظار قبول Guest
  - **Scheduled:** بعد القبول، إذا كانت مجدولة
  - **Ready:** بعد القبول، إذا كانت فورية
  - **Live:** عند بدء البث
  - **Completed:** عند إنهاء البث
  - **Archived:** بعد حساب النتائج وحفظ التسجيل
  - عدم إمكانية التراجع عن الحالات
  - تسجيل timestamp لكل تحول
- **أولوية:** حرجة
- **الاختبار:** إنشاء منافسة ومتابعتها عبر كل الحالات

---

### FR-3: نظام البث المباشر (Live Streaming System)

#### FR-3.1: بدء البث
**FR-3.1.1** يجب أن يتمكن الـ Host من بدء البث في الوقت المحدد
- **معايير القبول:**
  - زر "بدء البث" يظهر فقط:
    - إذا كانت المنافسة "Ready" أو "Scheduled"
    - إذا كان الوقت الحالي ≥ الوقت المحدد (للمجدولة)
  - عند الضغط:
    - طلب أذونات الكاميرا والميكروفون
    - إنشاء جلسة WebRTC
    - تغيير حالة المنافسة إلى "Live"
    - إشعار للـ Guest ببدء البث
    - إتاحة المنافسة للمشاهدين
- **أولوية:** حرجة
- **الاختبار:** بدء بث والتحقق من تشغيل الكاميرا

**FR-3.1.2** يجب أن ينضم الـ Guest للبث تلقائياً
- **معايير القبول:**
  - إشعار فوري عند بدء الـ Host
  - زر "انضمام للبث"
  - طلب أذونات الكاميرا والميكروفون
  - الانضمام لجلسة WebRTC
  - ظهور الفيديوهين للطرفين
- **أولوية:** حرجة
- **الاختبار:** بدء بث كـ Host والانضمام كـ Guest

**FR-3.1.3** يجب استخدام WebRTC كطريقة أساسية للبث
- **معايير القبول:**
  - اتصال P2P بين Host و Guest
  - تأخير أقل من 3 ثواني
  - جودة فيديو قابلة للتعديل (360p, 480p, 720p)
  - fallback إلى Jitsi إذا فشل P2P
  - عرض حالة الاتصال (جيد/متوسط/ضعيف)
- **أولوية:** حرجة
- **الاختبار:** بدء بث وقياس التأخير

#### FR-3.2: أثناء البث
**FR-3.2.1** يجب أن يتمكن المتنافسان من التحكم في الكاميرا والميكروفون
- **معايير القبول:**
  - زر تشغيل/إيقاف الكاميرا
  - زر تشغيل/إيقاف الميكروفون
  - عرض حالة الميكروفون (مفتوح/مغلق) للطرف الآخر
  - إمكانية التبديل بين كاميرات متعددة
- **أولوية:** عالية
- **الاختبار:** تشغيل/إيقاف كل عنصر والتحقق من التطبيق

**FR-3.2.2** يجب عرض مؤقت للبث
- **معايير القبول:**
  - عرض الوقت المنقضي منذ البدء
  - عرض الوقت المتبقي (من المدة المتوقعة)
  - تحذير عند الوصول إلى 110 دقيقة (قبل نهاية الساعتين بـ 10 دقائق)
  - إيقاف تلقائي عند 120 دقيقة
- **أولوية:** متوسطة
- **الاختبار:** بدء بث ومراقبة المؤقت

**FR-3.2.3** يجب معالجة حالات انقطاع الاتصال
- **معايير القبول:**
  - **إذا انقطع أحد المتنافسين:**
    - عرض رسالة "في انتظار عودة [الاسم]"
    - الطرف الآخر يستمر في البث
    - إعادة الاتصال التلقائي خلال 30 ثانية
    - إذا لم يعد خلال 5 دقائق: عرض خيار "إنهاء البث"
  - **إذا انقطع الاثنين:**
    - إيقاف البث تلقائياً
    - محاولة إعادة الاتصال
    - إذا عاد أحدهما خلال 5 دقائق: إعادة البث
    - إذا لم يعد أحد: إنهاء المنافسة
- **أولوية:** عالية
- **الاختبار:** محاكاة انقطاع والتحقق من السلوك

#### FR-3.3: إنهاء البث
**FR-3.3.1** يجب أن يتمكن أي من المتنافسين من إنهاء البث
- **معايير القبول:**
  - زر "إنهاء البث"
  - تأكيد قبل الإنهاء
  - عند الضغط:
    - إيقاف البث فوراً
    - تغيير حالة المنافسة إلى "Completed"
    - إيقاف التقييم
    - بدء حساب النتائج
    - بدء حفظ التسجيل
- **أولوية:** حرجة
- **الاختبار:** إنهاء بث والتحقق من إيقاف كل العمليات

**FR-3.3.2** يجب إنهاء البث تلقائياً عند 120 دقيقة
- **معايير القبول:**
  - إيقاف تلقائي بدون تأكيد
  - رسالة "انتهى الوقت المسموح"
  - نفس إجراءات الإنهاء اليدوي
- **أولوية:** متوسطة
- **الاختبار:** بدء بث وانتظار 120 دقيقة (أو تسريع للاختبار)

---

### FR-4: نظام التقييم (Rating System)

#### FR-4.1: التقييم أثناء البث
**FR-4.1.1** يجب أن يتمكن المشاهدون من تقييم المتنافسين أثناء البث
- **معايير القبول:**
  - عرض تقييم لكل متنافس (0-100 نقطة)
  - 5 نجوم، كل نجمة = 20 نقطة
  - إمكانية إعطاء:
    - 0 للاثنين
    - 100 للاثنين
    - أي توزيع بينهما
  - إمكانية تعديل التقييم أي وقت طوال البث
  - حفظ تلقائي عند كل تعديل
- **أولوية:** حرجة
- **الاختبار:** تقييم متنافسين بقيم مختلفة والتحقق من الحفظ

**FR-4.1.2** يجب عرض مؤشر live للنقاط الإجمالية
- **معايير القبول:**
  - عرض مجموع نقاط كل متنافس في الوقت الفعلي
  - تحديث فوري عند كل تقييم جديد
  - عرض عدد المقيّمين
  - عرض النسبة المئوية لكل متنافس
  - تصميم واضح وسهل القراءة
- **أولوية:** عالية
- **الاختبار:** تقييم والتحقق من تحديث المؤشر فوراً

**FR-4.1.3** يجب منع التقييم بعد انتهاء البث
- **معايير القبول:**
  - إخفاء أزرار التقييم فور الإنهاء
  - تعطيل أي محاولة تقييم عبر API
  - عرض رسالة "التقييم مغلق"
  - عرض النتائج النهائية
- **أولوية:** حرجة
- **الاختبار:** محاولة تقييم بعد انتهاء البث

#### FR-4.2: حساب النتائج
**FR-4.2.1** يجب حساب النتائج النهائية فور انتهاء البث
- **معايير القبول:**
  - جمع كل نقاط المتنافس أ
  - جمع كل نقاط المتنافس ب
  - حساب المجموع الكلي = نقاط أ + نقاط ب
  - حساب نسبة أ = (نقاط أ ÷ المجموع الكلي) × 100
  - حساب نسبة ب = (نقاط ب ÷ المجموع الكلي) × 100
  - حفظ النتائج في قاعدة البيانات
  - عرض النتائج للجميع
- **أولوية:** حرجة
- **الاختبار:** إنهاء بث والتحقق من دقة الحسابات

---

### FR-5: نظام التعليقات (Comments System)

#### FR-5.1: التعليق أثناء البث
**FR-5.1.1** يجب أن يتمكن المشاهدون من التعليق أثناء البث المباشر
- **معايير القبول:**
  - صندوق تعليق في صفحة البث
  - كتابة تعليق (max 500 حرف)
  - إرسال التعليق
  - ظهور فوري لكل المشاهدين
  - عرض: اسم المعلق، صورته، وقت التعليق
  - تسجيل timestamp التعليق
- **أولوية:** عالية
- **الاختبار:** كتابة تعليق والتحقق من ظهوره

**FR-5.1.2** يجب عرض التعليقات في الوقت الفعلي
- **معايير القبول:**
  - ظهور تلقائي بدون تحديث الصفحة
  - ترتيب من الأحدث للأقدم
  - scroll تلقائي للتعليق الجديد
  - عرض عدد التعليقات
- **أولوية:** متوسطة
- **الاختبار:** إرسال تعليقات من أجهزة مختلفة والتحقق من الظهور

#### FR-5.2: التعليقات المسجلة
**FR-5.2.1** يجب تجميد التعليقات بعد انتهاء البث
- **معايير القبول:**
  - إخفاء صندوق التعليق
  - عرض رسالة "التعليقات مغلقة"
  - عدم إمكانية إضافة تعليقات جديدة
  - الاحتفاظ بكل التعليقات السابقة
- **أولوية:** متوسطة
- **الاختبار:** محاولة التعليق بعد انتهاء البث

**FR-5.2.2** يجب مزامنة التعليقات مع الفيديو المسجل
- **معايير القبول:**
  - عرض التعليق في نفس الوقت الذي كُتب فيه أثناء البث
  - إذا الفيديو عند دقيقة 15: عرض تعليقات دقيقة 15 من البث
  - تحديث التعليقات المعروضة مع تقدم الفيديو
  - عرض: "لا توجد تعليقات في هذا الوقت" إذا لم يكن هناك تعليقات
- **أولوية:** عالية
- **الاختبار:** تشغيل فيديو مسجل والتحقق من توقيت التعليقات

---

### FR-6: نظام الأرشفة (Archiving System)

#### FR-6.1: التسجيل التلقائي
**FR-6.1.1** يجب تسجيل البث المباشر تلقائياً
- **معايير القبول:**
  - بدء التسجيل فور بدء البث
  - تسجيل الفيديو بجودة 720p (أو أقل إذا كان الاتصال ضعيف)
  - تسجيل الصوت بوضوح
  - تسجيل timestamp البداية والنهاية
  - حفظ في تنسيق WebM أو MP4
- **أولوية:** حرجة
- **الاختبار:** بدء بث والتحقق من حفظ التسجيل

**FR-6.1.2** يجب حفظ التعليقات مع timestamps
- **معايير القبول:**
  - تسجيل كل تعليق مع وقت إرساله من بداية البث
  - حفظ في قاعدة البيانات
  - ربط بـ ID المنافسة
- **أولوية:** عالية
- **الاختبار:** التعليق أثناء بث والتحقق من حفظ التوقيت

#### FR-6.2: المشاهدة بعد الأرشفة
**FR-6.2.1** يجب إتاحة مشاهدة التسجيل بعد انتهاء البث
- **معايير القبول:**
  - ظهور زر "مشاهدة التسجيل" فور حالة "Archived"
  - تشغيل الفيديو بسلاسة
  - عرض التعليقات في توقيتها
  - عرض النتائج النهائية
  - عدد المشاهدات
- **أولوية:** حرجة
- **الاختبار:** مشاهدة تسجيل والتحقق من كل العناصر

**FR-6.2.2** يجب إتاحة تحميل التسجيل للجميع
- **معايير القبول:**
  - زر "تحميل" في صفحة التسجيل
  - تحميل ملف MP4
  - الملف يحتوي على الفيديو والصوت فقط (بدون التعليقات)
  - حجم ملف معقول (ضغط معتدل)
- **أولوية:** منخفضة
- **الاختبار:** تحميل ملف والتحقق من المحتوى

#### FR-6.3: حقوق النشر
**FR-6.3.1** يجب منع رفع التسجيل على منصات خارجية إلا من الإدارة
- **معايير القبول:**
  - رسالة في صفحة التسجيل: "حقوق النشر على منصات خارجية حصرية للإدارة"
  - التحميل متاح لكن بشرط عدم الرفع التجاري
  - إمكانية الإبلاغ عن رفع غير مصرح به
- **أولوية:** منخفضة
- **الاختبار:** قراءة الرسالة والتحقق من وضوحها

---

### FR-7: نظام الإعلانات (Advertising System)

#### FR-7.1: حجز الإعلانات (من المعلن)
**FR-7.1.1** يجب أن يتمكن المعلن من التواصل مع الإدارة لحجز إعلان
- **معايير القبول:**
  - نموذج "طلب إعلان" في الموقع
  - إدخال: اسم الشركة، البريد، رقم الهاتف، الميزانية، الاستهداف المطلوب
  - إرسال الطلب للإدارة
  - رد من الإدارة خلال 48 ساعة
- **أولوية:** متوسطة
- **الاختبار:** إرسال طلب إعلان والتحقق من استلام الإدارة

**FR-7.1.2** يجب ألا يُعرض أي إعلان بدون دفع مسبق
- **معايير القبول:**
  - نظام دفع آمن (Stripe أو PayPal)
  - تأكيد الدفع من بوابة الدفع
  - تفعيل الإعلان فقط بعد تأكيد الدفع
  - إرسال فاتورة للمعلن
- **أولوية:** حرجة
- **الاختبار:** محاولة تفعيل إعلان بدون دفع (يجب أن يفشل)

#### FR-7.2: عرض الإعلانات
**FR-7.2.1** يجب عرض الإعلانات أثناء البث المباشر
- **معايير القبول:**
  - إعلان قبل بدء البث (Pre-roll, 5-15 ثانية)
  - إعلان في منتصف البث إذا أطول من 30 دقيقة (Mid-roll, 5-10 ثواني)
  - إمكانية تخطي بعد 5 ثواني
  - عدم قطع صوت المتنافسين أثناء الإعلان
- **أولوية:** عالية
- **الاختبار:** مشاهدة بث والتحقق من ظهور الإعلانات

**FR-7.2.2** يجب عرض الإعلانات في التسجيلات
- **معايير القبول:**
  - إعلان قبل تشغيل التسجيل (Pre-roll)
  - إعلانات في أوقات محددة خلال التسجيل (كل 15 دقيقة)
  - تسجيل كل مشاهدة ونقرة
- **أولوية:** عالية
- **الاختبار:** تشغيل تسجيل والتحقق من الإعلانات

#### FR-7.3: حظر الإعلانات (للمتنافس)
**FR-7.3.1** يجب أن يتمكن المتنافس من حظر إعلانات معينة
- **معايير القبول:**
  - قائمة بكل الإعلانات المحجوزة
  - زر "حظر" لكل إعلان
  - عند الحظر:
    - عدم عرض الإعلان في منافسات هذا المتنافس
    - استبدال تلقائي بإعلان آخر
    - عدم اختفاء فوري (الاستبدال يحدث في العرض التالي)
- **أولوية:** متوسطة
- **الاختبار:** حظر إعلان والتحقق من عدم ظهوره

**FR-7.3.2** يجب حظر الإعلان إذا رفضه أحد المتنافسين
- **معايير القبول:**
  - إذا Host حظر إعلان → لا يظهر
  - إذا Guest حظر إعلان → لا يظهر
  - إذا كلاهما وافق → يظهر
- **أولوية:** متوسطة
- **الاختبار:** Host يحظر وGuest يوافق، التحقق من عدم الظهور

#### FR-7.4: الشفافية الإعلانية
**FR-7.4.1** يجب عرض صفحة عامة بكل الإعلانات
- **معايير القبول:**
  - عرض: اسم المعلن، تاريخ الحجز، المبلغ المدفوع
  - عرض: المنافسات المستهدفة، عدد المشاهدات، عدد النقرات
  - تحديث يومي
  - إمكانية البحث والفلترة
- **أولوية:** متوسطة
- **الاختبار:** فتح الصفحة والتحقق من دقة البيانات

---

### FR-8: نظام الأرباح والمدفوعات (Revenue & Payment System)

#### FR-8.1: حساب الأرباح
**FR-8.1.1** يجب حساب أرباح كل منافسة بعد انتهائها
- **معايير القبول:**
  - جمع إيرادات كل الإعلانات المعروضة (في البث والتسجيل)
  - حساب نصيب المنصة = 20%
  - حساب نصيب المتنافسين = 80%
  - توزيع الـ 80% حسب نسبة النقاط:
    - ربح المتنافس أ = (نسبة نقاطه) × 80% من الإيراد
    - ربح المتنافس ب = (نسبة نقاطه) × 80% من الإيراد
  - حفظ التفاصيل في قاعدة البيانات
- **أولوية:** حرجة
- **الاختبار:** إنشاء منافسة بإعلانات والتحقق من دقة الحسابات

**FR-8.1.2** يجب تتبع الأرباح من كل إعلان ومنافسة
- **معايير القبول:**
  - صفحة "أرباحي" في الملف الشخصي
  - عرض جدول:
    - اسم المنافسة
    - الإعلانات المعروضة
    - الإيراد من كل إعلان
    - النسبة المستحقة
    - المبلغ المستحق
    - حالة الدفع (معلق/مدفوع)
    - تاريخ الدفع
  - تحديث فوري
- **أولوية:** عالية
- **الاختبار:** فتح صفحة أرباحي والتحقق من التفاصيل

#### FR-8.2: استلام الأرباح
**FR-8.2.1** يجب أن يتمكن المتنافس من تسجيل طريقة استلام الأموال
- **معايير القبول:**
  - قسم "الحساب المالي" في الإعدادات
  - خيارات:
    - حساب بنكي (IBAN, Swift Code, اسم البنك)
    - PayPal (البريد)
    - Wise (البريد)
  - إمكانية إضافة أكثر من طريقة
  - اختيار طريقة افتراضية
  - حفظ آمن ومشفر
- **أولوية:** حرجة
- **الاختبار:** إضافة حساب والتحقق من الحفظ

**FR-8.2.2** يجب ألا يتم الدفع إلا بعد استلام المنصة للمال من المعلنين
- **معايير القبول:**
  - حالة الدفع تبقى "معلق" حتى:
    - تأكيد استلام المال من المعلن
    - مرور 7 أيام من عرض الإعلان (فترة أمان)
  - بعد التأكيد:
    - تحويل المبلغ للمتنافس
    - تغيير الحالة إلى "مدفوع"
    - إرسال إشعار وفاتورة
- **أولوية:** حرجة
- **الاختبار:** متابعة دفعة من "معلق" إلى "مدفوع"

#### FR-8.3: الفواتير والإيصالات
**FR-8.3.1** يجب إصدار فاتورة لكل دفعة
- **معايير القبول:**
  - فاتورة PDF تحتوي:
    - رقم الفاتورة
    - التاريخ
    - اسم المستلم
    - تفاصيل المنافسات
    - الإعلانات
    - الأرباح
    - المبلغ الإجمالي
  - إمكانية التحميل
  - إرسال نسخة للبريد
- **أولوية:** متوسطة
- **الاختبار:** تحميل فاتورة والتحقق من محتواها

#### FR-8.4: المنح والدعم
**FR-8.4.1** يجب أن يتمكن المستخدم من إرسال دعم للمنصة
- **معايير القبول:**
  - صفحة "دعم المنصة"
  - إدخال المبلغ (min $1)
  - اختيار طريقة الدفع
  - رسالة اختيارية
  - عرض اسم المتبرع علنياً (إلا إذا اختار الإخفاء)
- **أولوية:** منخفضة
- **الاختبار:** إرسال دعم والتحقق من الظهور

**FR-8.4.2** يجب أن يتمكن المستخدم من إرسال دعم لمستخدم آخر
- **معايير القبول:**
  - زر "دعم" في ملف المستخدم
  - إدخال المبلغ
  - رسالة اختيارية
  - عرض في ملف المستقبِل (إذا وافق المرسل)
- **أولوية:** منخفضة
- **الاختبار:** إرسال دعم والتحقق من الإشعار

---

### FR-9: نظام البلاغات والإشراف (Reporting & Moderation System)

#### FR-9.1: تقديم البلاغات
**FR-9.1.1** يجب أن يتمكن أي مستخدم مسجل من تقديم بلاغ
- **معايير القبول:**
  - زر "إبلاغ" في:
    - صفحة المنافسة
    - ملف المستخدم
    - التعليقات
  - اختيار نوع البلاغ:
    - محتوى غير لائق
    - تحرش
    - spam
    - معلومات مضللة
    - آخر (يجب كتابة السبب)
  - كتابة وصف (50-500 حرف)
  - إرفاق صورة أو فيديو (اختياري)
  - إرسال البلاغ
- **أولوية:** عالية
- **الاختبار:** تقديم بلاغ والتحقق من إرساله

**FR-9.1.2** يجب عرض البلاغ في صفحة عامة فور تقديمه
- **معايير القبول:**
  - صفحة "البلاغات" متاحة للجميع
  - عرض:
    - رقم البلاغ
    - نوع البلاغ
    - المُبلّغ (اسم + رابط ملف)
    - المُبلّغ عنه (اسم + رابط)
    - التاريخ والوقت
    - الوصف
    - الحالة (معلق/قيد التحقيق/مكتمل/مرفوض)
  - ترتيب من الأحدث
  - إمكانية البحث
- **أولوية:** عالية
- **الاختبار:** تقديم بلاغ والتحقق من ظهوره في الصفحة

#### FR-9.2: معالجة البلاغات (للإدارة)
**FR-9.2.1** يجب أن يتمكن المشرف من استلام البلاغ
- **معايير القبول:**
  - إشعار للمشرفين عند بلاغ جديد
  - زر "استلام" للبلاغ
  - عند الاستلام:
    - تسجيل اسم المشرف
    - تسجيل التاريخ والوقت
    - تغيير الحالة إلى "قيد التحقيق"
    - عرض ذلك في الصفحة العامة
- **أولوية:** عالية
- **الاختبار:** استلام بلاغ والتحقق من التسجيل

**FR-9.2.2** يجب أن يتمكن المشرف من اتخاذ إجراء
- **معايير القبول:**
  - خيارات:
    - حذف المحتوى
    - حظر المستخدم (1 يوم، 7 أيام، 30 يوم، دائم)
    - تحذير المستخدم
    - رفض البلاغ (لا مخالفة)
    - تصعيد لمستوى أعلى
  - كتابة سبب الإجراء (إلزامي، 50-500 حرف)
  - عند الإجراء:
    - تنفيذ الإجراء فوراً
    - تغيير حالة البلاغ إلى "مكتمل" أو "مرفوض"
    - عرض الإجراء والسبب في الصفحة العامة
    - إشعار للمُبلّغ والمُبلّغ عنه
- **أولوية:** حرجة
- **الاختبار:** اتخاذ كل إجراء والتحقق من التنفيذ

#### FR-9.3: طلب المراجعة
**FR-9.3.1** يجب أن يتمكن أي طرف من طلب مراجعة القرار
- **معايير القبول:**
  - زر "طلب مراجعة" في صفحة البلاغ
  - متاح للمُبلّغ والمُبلّغ عنه
  - كتابة سبب طلب المراجعة (50-500 حرف)
  - إرسال للمستوى الإداري الأعلى
  - عرض الطلب في الصفحة العامة
- **أولوية:** متوسطة
- **الاختبار:** طلب مراجعة والتحقق من الإرسال

**FR-9.3.2** يجب أن يتمكن المشرف الأعلى من مراجعة القرار
- **معايير القبول:**
  - عرض القرار الأول + سببه
  - عرض طلب المراجعة + سببه
  - خيارات:
    - تأييد القرار الأول
    - تعديل القرار (وكتابة السبب)
  - عرض القرار النهائي في الصفحة العامة
  - إشعار لكل الأطراف
- **أولوية:** متوسطة
- **الاختبار:** مراجعة قرار والتحقق من التنفيذ

#### FR-9.4: تقييم الجمهور لأداء الإدارة
**FR-9.4.1** يجب أن يتمكن الجمهور من تقييم قرار الإدارة
- **معايير القبول:**
  - زر "راضٍ" و "غير راضٍ" في كل بلاغ مكتمل
  - إمكانية التعليق على القرار
  - عرض إحصائيات:
    - نسبة الرضا
    - عدد الأصوات
    - عدد التعليقات
  - عرض التعليقات علنياً
- **أولوية:** منخفضة
- **الاختبار:** تقييم قرار والتحقق من عرض الإحصائيات

---

### FR-10: الشفافية الإدارية (Administrative Transparency)

#### FR-10.1: عرض فريق الإدارة
**FR-10.1.1** يجب عرض صفحة عامة بكل فريق الإدارة
- **معايير القبول:**
  - صفحة "فريق الإدارة"
  - عرض لكل موظف:
    - الاسم الكامل
    - الصورة
    - الدور (Admin, Supervisor, Moderator, Support)
    - الراتب الشهري بالدولار
    - أي دخل إضافي من المنصة
    - تاريخ الانضمام
    - عدد البلاغات المعالجة
    - متوسط وقت الاستجابة
  - تحديث شهري
- **أولوية:** متوسطة
- **الاختبار:** فتح الصفحة والتحقق من البيانات

#### FR-10.2: سجل إجراءات الإدارة
**FR-10.2.1** يجب عرض سجل كامل بكل إجراء إداري
- **معايير القبول:**
  - صفحة "سجل الإجراءات"
  - عرض:
    - التاريخ والوقت
    - اسم المشرف
    - نوع الإجراء (حذف، حظر، تحذير، إلخ)
    - الهدف (مستخدم، منافسة، تعليق)
    - السبب
  - إمكانية الفلترة حسب المشرف أو النوع
  - ترتيب من الأحدث
- **أولوية:** منخفضة
- **الاختبار:** اتخاذ إجراء والتحقق من ظهوره في السجل

---

### FR-11: البحث والاكتشاف (Search & Discovery)

#### FR-11.1: البحث العام
**FR-11.1.1** يجب توفر شريط بحث موحد
- **معايير القبول:**
  - شريط بحث في الصفحة الرئيسية
  - البحث في:
    - المنافسات (عنوان، وصف)
    - المستخدمين (اسم)
  - عرض نتائج منفصلة:
    - قسم "منافسات"
    - قسم "مستخدمين"
  - ترتيب حسب الأكثر صلة
  - تحديث فوري أثناء الكتابة (live search)
- **أولوية:** عالية
- **الاختبار:** البحث عن كلمة والتحقق من النتائج

#### FR-11.2: الفلترة المتقدمة
**FR-11.2.1** يجب توفر فلاتر للمنافسات
- **معايير القبول:**
  - فلترة حسب:
    - القسم (نزاع، علم، موهبة، إلخ)
    - الحالة (حية، قادمة، منتهية)
    - التقييم (4-5 نجوم، 3-4، 2-3، أقل من 2)
    - التاريخ (اليوم، الأسبوع، الشهر، كل الوقت)
  - تطبيق فوري عند التحديد
  - إمكانية إزالة الفلاتر
- **أولوية:** متوسطة
- **الاختبار:** تطبيق فلاتر مختلفة والتحقق من النتائج

**FR-11.2.2** يجب توفر فلاتر للمستخدمين
- **معايير القبول:**
  - فلترة حسب:
    - القسم المفضل
    - متوسط التقييم
    - عدد المنافسات (0-5، 5-20، 20+)
  - ترتيب حسب (الأحدث، الأعلى تقييماً، الأكثر منافسات)
- **أولوية:** منخفضة
- **الاختبار:** فلترة مستخدمين والتحقق من النتائج

---

### FR-12: التدويل (Internationalization)

#### FR-12.1: دعم اللغات
**FR-12.1.1** يجب دعم لغات متعددة
- **معايير القبول:**
  - اللغات المدعومة:
    - العربية (RTL)
    - الإنجليزية (LTR)
    - [لغات أخرى تُضاف لاحقاً]
  - قائمة اختيار اللغة في الإعدادات
  - تغيير فوري عند الاختيار
  - حفظ الاختيار للزيارات القادمة
  - دعم RTL/LTR تلقائي
- **أولوية:** عالية
- **الاختبار:** تغيير اللغة والتحقق من تطبيق الترجمة

#### FR-12.2: التوقيت المحلي
**FR-12.2.1** يجب عرض التوقيت حسب منطقة المستخدم
- **معايير القبول:**
  - كشف المنطقة الزمنية تلقائياً
  - عرض كل الأوقات بالمنطقة المحلية
  - عند جدولة منافسة:
    - الـ Host يحدد بتوقيته
    - الـ Guest يرى بتوقيته
  - عرض المنطقة الزمنية بوضوح (مثلاً: "5:00 PM GMT+2")
- **أولوية:** متوسطة
- **الاختبار:** جدولة منافسة والتحقق من التحويل الصحيح

---

### FR-13: الأمان (Security)

#### FR-13.1: حماية الحسابات
**FR-13.1.1** يجب تشفير كلمات المرور
- **معايير القبول:**
  - استخدام bcrypt أو Argon2
  - salt لكل كلمة مرور
  - عدم إمكانية استرجاع كلمة المرور الأصلية
- **أولوية:** حرجة
- **الاختبار:** فحص قاعدة البيانات والتحقق من التشفير

**FR-13.1.2** يجب حماية الجلسات (Sessions)
- **معايير القبول:**
  - استخدام tokens آمنة
  - انتهاء الجلسة بعد 7 أيام من عدم النشاط
  - تسجيل خروج تلقائي عند تغيير كلمة المرور
  - HttpOnly cookies
  - Secure flag في HTTPS
- **أولوية:** حرجة
- **الاختبار:** فحص cookies والتحقق من الأمان

#### FR-13.2: حماية البيانات
**FR-13.2.1** يجب تشفير البيانات الحساسة
- **معايير القبول:**
  - تشفير معلومات الدفع (IBAN, حسابات بنكية)
  - تشفير الرسائل الخاصة
  - استخدام HTTPS في كل الاتصالات
- **أولوية:** حرجة
- **الاختبار:** فحص الاتصالات والتحقق من HTTPS

#### FR-13.3: منع الهجمات
**FR-13.3.1** يجب الحماية من SQL Injection
- **معايير القبول:**
  - استخدام Prepared Statements
  - تعقيم كل المدخلات
  - عدم بناء queries يدوياً
- **أولوية:** حرجة
- **الاختبار:** محاولة حقن SQL والتحقق من الفشل

**FR-13.3.2** يجب الحماية من XSS
- **معايير القبول:**
  - تعقيم كل المدخلات المعروضة
  - escape HTML tags
  - Content Security Policy headers
- **أولوية:** حرجة
- **الاختبار:** محاولة حقن script والتحقق من الفشل

**FR-13.3.3** يجب الحماية من CSRF
- **معايير القبول:**
  - استخدام CSRF tokens
  - التحقق من الـ token في كل request
  - SameSite cookies
- **أولوية:** حرجة
- **الاختبار:** محاولة CSRF attack والتحقق من الفشل

---

## 2. المتطلبات غير الوظيفية (Non-Functional Requirements)

### NFR-1: الأداء (Performance)

**NFR-1.1** يجب أن يكون وقت تحميل الصفحة أقل من 2 ثانية
- **معايير القياس:** استخدام Lighthouse أو WebPageTest
- **الهدف:** Score > 90

**NFR-1.2** يجب أن يكون تأخير البث أقل من 3 ثواني
- **معايير القياس:** قياس الفرق بين وقت الإرسال والاستقبال
- **الهدف:** Latency < 3s

**NFR-1.3** يجب أن يدعم النظام 10,000 مشاهد متزامن في منافسة واحدة
- **معايير القياس:** اختبار حمل (Load Testing)
- **الهدف:** استجابة طبيعية مع 10k users

### NFR-2: القابلية للتوسع (Scalability)

**NFR-2.1** يجب أن يدعم النظام 100+ بث متزامن
- **معايير القياس:** اختبار حمل
- **الهدف:** استقرار مع 100 بث نشط

**NFR-2.2** يجب أن تكون قاعدة البيانات قابلة للتوسع
- **معايير القياس:** اختبار مع 1M+ سجل
- **الهدف:** استعلامات < 100ms

### NFR-3: الموثوقية (Reliability)

**NFR-3.1** يجب أن تكون نسبة التوفر 99.9%
- **معايير القياس:** uptime monitoring
- **الهدف:** Uptime > 99.9% شهرياً

**NFR-3.2** يجب حفظ backup يومي
- **معايير القياس:** فحص logs
- **الهدف:** backup ناجح كل 24 ساعة

### NFR-4: سهولة الاستخدام (Usability)

**NFR-4.1** يجب أن تكون الواجهة سهلة الاستخدام
- **معايير القياس:** User testing
- **الهدف:** 90% من المستخدمين ينجحون في إنشاء منافسة من أول مرة

**NFR-4.2** يجب أن تكون الواجهة متجاوبة (Responsive)
- **معايير القياس:** اختبار على أجهزة مختلفة
- **الهدف:** عمل صحيح على Mobile, Tablet, Desktop

### NFR-5: التوافقية (Compatibility)

**NFR-5.1** يجب دعم المتصفحات الحديثة
- **المتصفحات:** Chrome (آخر إصدارين), Firefox (آخر إصدارين), Safari (آخر إصدارين), Edge (آخر إصدارين)
- **الهدف:** كل المميزات تعمل بشكل صحيح

---

## 3. قيود النظام (System Constraints)

### SC-1: القيود التقنية
- يجب استخدام Cloudflare Workers للـ API
- يجب استخدام Cloudflare D1 لقاعدة البيانات
- يجب استخدام WebRTC للبث المباشر
- يجب استخدام Jitsi كـ fallback

### SC-2: القيود القانونية
- يجب الالتزام بـ GDPR
- يجب الالتزام بقوانين الخصوصية
- يجب الالتزام بحقوق النشر

### SC-3: القيود المالية
- نموذج الربح ثابت: 20% للمنصة، 80% للمتنافسين
- لا يمكن تغيير النسب

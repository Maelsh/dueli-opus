# ุฏููู ุงููุทูุฑูู ููุดุฑูุน ุฏูููู (Dueli) - ุงููุฑุฌุน ุงูุชููู ุงูุดุงูู

ุชุนุชุจุฑ ูุฐู ุงููุซููุฉ ูู ุงูุฏููู ุงูุชููู ุงูููุงุฆู ูุงููุญุฏุซ ูููุทูุฑูู ุงูุนุงูููู ุนูู ููุตุฉ ุฏูููู. ุชุบุทู ุงููุซููุฉ ุฃููุงุท ุงูููุฏุณุฉ ุงูุจุฑูุฌูุฉุ ุงููุจุงุฏุฆ ุงูุฅูุฒุงููุฉุ ูุชุงุฆุฌ ุงูุชุฏููู ุงูุนููู ููููุฏุ ูุชูุซููุงู ูุงููุงู ููุชุงุฑูุฎ ุงูุฅุฌุฑุงุฆู ููุฌูุณุงุช ุงูุญุงููุฉ.

---

## 1. ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ (ุงูุฃุฑุจุนุฉ ุงูุฅูุฒุงููุฉ)

ูุฌุจ ุฃู ููุชุฒู ุฃู ููุฏ ุจุฑูุฌู ูุชู ุฅุถุงูุชู ูุฏูููู ุจูุฐู ุงููุจุงุฏุฆ ุงูุฃุฑุจุนุฉ. ุฃู ูุฎุงููุฉ ุณุชุนุชุจุฑ ุงูุชูุงูุงู ุจุฑูุฌูุงู ูุฌุจ ุฅุตูุงุญู ููุฑุงู.

### โ. ุฏุนู ุงููุบุฉ ุงูุนุงููู (i18n)
- **ุงููุงุนุฏุฉ**: ูููุน ููุนุงู ุจุงุชุงู ุงุณุชุฎุฏุงู ูุตูุต ููุชูุจุฉ ูุจุงุดุฑุฉ (Hardcoded) ูู ุฃู ููุงู ุจุงููุงุฌูุฉ.
- **ุงูุชูููุฐ**: ุงุณุชุฎุฏู ุฏุงูุฉ `t()` ุฃู ุงููุชุฑุฌู `tr` ูู ูููุงุช `src/i18n`.

### โก. ุงูุจุฑูุฌุฉ ูุงุฆููุฉ ุงูุชูุฌู (OOP)
- **ุงููุงุนุฏุฉ**: ุงูุงูุชุฒุงู ุจูุธุงู ุงููุฆุงุช (Classes) ูุชุฌูุจ "ุงูุฏูุงู ุงูุทุงุฆุฑุฉ" (Global Functions).
- **ุงูููุท**: ุงูุชุบููู ุงููุงูู ููููุทู ุฏุงุฎู ูุฆุงุช ูุชุฎุตุตุฉ (ูุซู `P2PConnection`).

### โข. ูุตู ุงูููุงู (MVC)
- **ุงููุงุนุฏุฉ**: ุงููุตู ุงูุตุงุฑู ุจูู ููุทู ุงูุจูุงูุงุช (Models)ุ ููุทู ุงูุชุญูู (Controllers)ุ ูุทุจูุฉ ุงูุนุฑุถ (Views).
- **ุงูุนุฑูุถ**: ูุฌูุฏุงุช `shared/components` ู `modules/pages` ูู ุงููุตุฏุฑ ุงููุญูุฏ ูููุงุฌูุงุช.

### โฃ. ุณูููุฉ ุงููุตูู (Accessibility)
- **ุงููุงุนุฏุฉ**: ุฏุนู ุฐูู ุงูุฅุนุงูุฉ ุงูุจุตุฑูุฉ ูู ุฌููุฑ ุงููุดุฑูุน.
- **ุงููุชุทูุจุงุช**: ุงุณุชุฎุฏุงู `aria-label` ู `title` ูุณูุงุช `for` ูู ูุงูุฉ ุงูููุงุฐุฌ ูุงูุฃุฒุฑุงุฑ.

---

## 2. ุงูุชุฏููู ุงูุชููู ุงูุนููู (Line-by-Line)

### ๐ฐ๏ธ ูุธุงู ุงูุฅุดุงุฑุงุช (`signaling/routes.ts`)
ุงููุธุงู ูุนุชูุฏ ุนูู **ูุธุงู ุงูุงูุชุฑุงุน (Polling)** ุงููุฏุนูู ุจูุงุนุฏุฉ ุจูุงูุงุช D1.
- **ุนูู ุงูุฒุฌุงุฌุฉ**: ูุนูู ุงูุงูุชุฑุงุน ูู `1000ms`. **ูุฐุง ูู ุงูุณุจุจ ุงูุฑุฆูุณู** ูุงููุทุงุน ุงูุจุซ ุจุนุฏ ุซูุงููุ ูุฃู ุจุฑูุชูููู WebRTC ูุญุชุงุฌ ูุชุจุงุฏู ุณุฑูุน ุฌุฏุงู ูููุนูููุงุชุ ูุงูุชุฃุฎูุฑ ูุซุงููุฉ ูุงููุฉ ูุคุฏู ููุดู ุงูุงุชุตุงู (ICE Failure).
- **ุฏูุฑุฉ ุญูุงุฉ ุงูุบุฑู**: ุชุจุฏุฃ ุจุจุงุฏุฆุฉ `comp_` ูุชูุญุฐู ุชููุงุฆูุงู ุนูุฏูุง ูุตุจุญ ุนุฏุฏ ุงููุถูููู ูุงูุฎุตูู ูุงููุดุงูุฏูู ุตูุฑุงู.

### ๐ก ุฎุฏูุฉ P2P (`P2PConnection.ts`)
- **ูุดู ุงูุตูุงุญูุงุช**: ูุชู ุทูุจ ุงููุงููุฑุง ุชููุงุฆูุงู ุนูุฏ ุชุญููู ุงูุตูุญุฉ. **ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ ุชููุน ุฐูู** ูุง ูู ููู ุงููุณุชุฎุฏู ุจุงูููุฑ ุนูู ุฒุฑ ูุงุถุญ. ูุฌุจ ููู ุทูุจ ุงูุตูุงุญูุงุช ููููู ุฏุงุฎู ุฏุงูุฉ ูุฑุชุจุทุฉ ุจุฒุฑ "ุจุฏุก ุงูุจุซ".
- **ุงูุจุฑูุชูููู**: ุชู ุชุตุญูุญ ุนูุงููู STUN ูุชุดูู ุงูุจุงุฏุฆุฉ `stun:` ุจุดูู ุฅูุฒุงูู.

### ๐ฅ ุชุทุจูู "ุงูุดุจุญ ุงููุฒุฏูุฌ" (Double-Ghost)
ุงููุดุฑูุน ูุญุชูู ุนูู ูุณุงุฑูู ูุชูุงูุถูู ููุจุซ:
1. **ูุธุงู Jitsi ุงููุฏูู (`LiveRoom.ts`)**: ูุนุชูุฏ ุนูู iframe ุฎุงุฑุฌู. ูุง ูุฒุงู ููุฌูุฏุงู ููุณุจุจ ุชุถุงุฑุจุงู ูู ุทูุจ ุงููุงููุฑุง.
2. **ูุธุงู P2P ุงููุฎุตุต (`P2PConnection.ts`)**: ูู ุงููุธุงู ุงูุญุงูู ุงูุฐู ูุฏุฑุณูุ ูุงูุฐู ูุฑุชุจุท ุจูุธุงู ุงูุชุณุฌูู.
**ุชูุจูู**: ุฃุญูุงูุงู ูุญุงูู ุงููุธุงู ุชุดุบูู ุงููุณุงุฑูู ูุนุงูุ ููุง ูุคุฏู ูููู ุงููุงููุฑุง ููุดู ุงูุจุซ.

### ๐ผ ูุณุงุฑ ุงูุชุณุฌูู (ุงูุชุฏููู ุงูุฌูุงุฆู)
- **ุงูุขููุฉ**: ูููู ูุชุตูุญ ุงููุถูู ุจุงูุชูุงุท ุตูุฑุฉ ุงูู Canvas ูุจุซ ููุฏููุ ูุชูุทูุนู ููุทุน (Blobs) ูุฏุชูุง 10 ุซูุงููุ ูุฅุฑุณุงููุง ูู `upload.php`.
- **ูุญุต ุงููุงูุน**:
    - **ุงูุงุณุชูุฑุงุฑูุฉ**: ุงููุทุน ุชูุฑุณู ุจุงููุนูุ ููู ูุง ููุฌุฏ ูุธุงู ุฅุนุงุฏุฉ ูุญุงููุฉ (Retry) ูู ุญุงู ูุดู ุงูุฅูุชุฑูุช ููุญุธุฉ.
    - **ุชุฎููู ุงูุฑุงุจุท**: ุงููุธุงู "ููุชุฑุถ" ูุฌูุฏ ุงูุฑุงุจุท (ูุซู `match_123.mp4`) ุจูุฌุฑุฏ ุงูุชูุงุก ุงูุจุซุ ุฏูู ุงูุชุฃูุฏ ูู ุฃู ุณูุฑูุฑ ุงูู PHP ูุฏ ุงูุชูู ูู ุนูููุฉ ุงูุฏูุฌ (Merge)ุ ููุง ูุณุจุจ ุฎุทุฃ 404.


---

## 3. ุงูุชุงุฑูุฎ ุงูุฅุฌุฑุงุฆู ููุฌูุณุฉ (Session History)

ุฎูุงู ุฌูุณุฉ ุงูุชุทููุฑ ูุงูุชุฏููู ุงูุญุงููุฉ (22 ุฏูุณูุจุฑ 2025)ุ ุชู ุฅูุฌุงุฒ ุงูุฎุทูุงุช ุงูุญุฑุฌุฉ ุงูุชุงููุฉ:

| ุงูุฎุทูุฉ | ุงููุดููุฉ | ุงูุญู ุงูุฐู ุชู ุชูููุฐู |
|------|-------|------------|
| **1** | **ุฎุทุฃ ูู ูุนููุงุช ุงูุฅุดุงุฑุงุช** | ุชุตุญูุญ ุทูุจุงุช `sendSignal` ู `poll`. ูุงูุช ุชุณุชุฎุฏู `user_id` ุจุดูู ุฎุงุทุฆ ูู ุญูู ุฃู ุงูู API ูุชููุน `role` (host/opponent). |
| **2** | **ุฎุทุฃ ุจุฑูุชูููู STUN** | ุชุตุญูุญ ุนูุงููู ุฎูุงุฏู Google STUN ุจุฅุถุงูุฉ ุงูุจุงุฏุฆุฉ ุงูููููุฏุฉ `stun:` ุงูุชู ูุงูุช ุชููุน ุงูุงุชุตุงู. |
| **3** | **ุชุถุงุฑุจ ุฃููุงุน ุงูุจูุงูุงุช** | ุชุญููู `user_id` ูู ูุต ุฅูู ุฑูู (Integer) ููุชูุงูู ูุน ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุน ุฃุฎุทุงุก ุงูู 500. |
| **4** | **ุจููุฉ ุงูุงุฎุชุจุงุฑ** | ุฅูุดุงุก ุตูุญุงุช ุงุฎุชุจุงุฑ ูุณุชููุฉ (`test/host`, `test/guest`) ูุนุฒู ุฃุฎุทุงุก ุงูุจุซ ุนู ูุธุงู ุงููุตุงุฏูุฉ ุงูุฑุฆูุณู. |
| **5** | **ุชูุญูุฏ ุงูุชูุซูู** | ุฏูุฌ ูุงูุฉ ูููุงุช ุงููููู ุงููุดุชุชุฉ ูู ูุฐุง ุงูุฏููู ุงูุซูุงุฆู ุงููุบุฉ ููุตุจุญ ุงููุฑุฌุน ุงููุญูุฏ. |

---

## 4. ุณุฌู "ุงูููุงุท ุงููุนููุฉ" (ุฃูู ุชููููุง)

ููุซู ูุฐุง ุงูุณุฌู ุงูููุงุท ุงูุชู ูู ุชูุชูู ูู ูุจู ุงููุทูุฑูู ุงูุณุงุจููู ุฃู ุงูุชู ุชููููุง ุนูุฏูุง ูู ูุฐู ุงูุฌูุณุฉ:

| ุงูููุฒุฉ | ุงููููุน | ุงูุญุงูุฉ | ูุง ุงูุฐู ูููุตูุงุ |
|---------|------|--------|---------------|
| **ุญุฐู ุงูุญุณุงุจ** | `settings-page.ts` | โ ูุชููู | ุงูุฏุงูุฉ ุงูุจุฑูุฌูุฉ ุชุธูุฑ ุชูุจููุงู ููุท ุฏูู ุญุฐู ุญูููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. |
| **ุณุญุจ ุงูุฃุฑุจุงุญ** | `earnings-page.ts` | โ ูุนูู | ูุง ููุฌุฏ API ูุฏุนู ุนูููุฉ ุงูุณุญุจ ุฎูู ุงููุงุฌูุฉ ุงูุจุฑูุฌูุฉ. |
| **ูุธุงู ุงูุฏูุน** | `donate-page.ts` | โ ุชุฌุฑูุจู | ูุญุชุงุฌ ูุฑุจุท ุจุจูุงุจุงุช Stripe ุฃู PayPal ุงูุญููููุฉ. |
| **ุชุดููุฑ ูููุงุช ุงููุฑูุฑ** | `CryptoUtils.ts` | โ๏ธ ูุฎุงุทุฑุฉ | ุงูููุฏ ูุณุชุฎุฏู SHA-256 ุงูุจุณูุท. **ูุฌุจ ุงูุชุฑููุฉ ููุฑุงู** ุฅูู BCrypt. |
| **ุณูููุฉ ุงููุตูู** | ูุงูู ุงููุดุฑูุน | ๐ด ุญุฑุฌ | ููุต ูุงุฆู ูู ุณูุงุช ARIA. **ูุฐุง ูู ุงูููุงู ุงูุฐู ูุฌุจ ุฃู ูุจุฏุฃ ููู ุงููุทูุฑ ุงููุงุฏู.** |

---

## 5. ุฃูู ุณููููุ (ุฎุฑูุทุฉ ุงูุทุฑูู)

1. **ุงูุฃููููุฉ ุงููุตูู**: ุชุฑุญูู ูุธุงู ุงูุชุดููุฑ ุฅูู BCrypt ูุถูุงู ุฃูู ุงููุณุชุฎุฏููู.
2. **ุงููุฑุญูุฉ ุงูุชุงููุฉ**: ูุนุงูุฌุฉ ุฃูุซุฑ ูู 100 ูุฎุงููุฉ ูุณูููุฉ ุงููุตูู (Accessibility) ูู ุตูุญุฉ ุงูููุงูุณุงุช.
3. **ุงูุฅููุงู ุงูููุฒุงุชู**: ุงูุจุฏุก ุจุฑุจุท ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช (ุญุฐู ุงูุญุณุงุจ) ุจุงูุฎูููุฉ ุงูุจุฑูุฌูุฉ ุจุดูู ุญูููู.

---

> [!IMPORTANT]
> ูุฐุง ุงูุฏููู ููุบู ูุงูุฉ ูููุงุช ุงูู Wiki ุงูุณุงุจูุฉ ููุนุชุจุฑ ุงููุฑุฌุน ุงูุฑุณูู ุงููุญูุฏ ููุนูุงุฑูุฉ ุงููุดุฑูุน ุงูุญุงููุฉ.

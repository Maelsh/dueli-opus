# Dueli Platform - Architecture Documentation
# ÙˆØ«Ø§Ø¦Ù‚ Ø¨Ù†ÙŠØ© Ù…Ù†ØµØ© Ø¯ÙŠÙˆÙ„ÙŠ

> **ØªØ­Ø°ÙŠØ± Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†**: Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙŠÙˆÙŠØ© Ø¹Ù† Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹. ÙŠØ¬Ø¨ Ù‚Ø±Ø§Ø¡ØªÙ‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù‚Ø¨Ù„ Ø¥Ø¬Ø±Ø§Ø¡ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„ØªØ¬Ù†Ø¨ Ø¥ÙØ³Ø§Ø¯ Ø§Ù„ÙƒÙˆØ¯.

---

## ğŸ“ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```
webapp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts                 # Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø®Ø§Ø¯Ù… (Hono)
â”‚   â”œâ”€â”€ i18n.ts                 # Re-export Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©
â”‚   â”œâ”€â”€ i18n/                   # Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø©
â”‚   â”‚   â”œâ”€â”€ index.ts            # Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙˆÙ…Ù†Ø·Ù‚ t()
â”‚   â”‚   â”œâ”€â”€ en.ts               # Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
â”‚   â”‚   â””â”€â”€ ar.ts               # Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
â”‚   â”œâ”€â”€ countries.ts            # Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ ÙˆØ§Ù„Ø£Ø¹Ù„Ø§Ù…
â”‚   â”œâ”€â”€ client/                 # ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ (Browser-side)
â”‚   â”‚   â”œâ”€â”€ index.ts            # Ù†Ù‚Ø·Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ (ÙŠÙØ¨Ù†Ù‰ Ø¥Ù„Ù‰ app.js)
â”‚   â”‚   â”œâ”€â”€ core/               # Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª
â”‚   â”‚   â”‚   â”œâ”€â”€ State.ts        # Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
â”‚   â”‚   â”‚   â”œâ”€â”€ ApiClient.ts    # Ø¹Ù…ÙŠÙ„ API
â”‚   â”‚   â”‚   â””â”€â”€ CookieUtils.ts  # Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙƒÙˆÙƒÙŠØ²
â”‚   â”‚   â”œâ”€â”€ services/           # Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthService.ts  # Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
â”‚   â”‚   â”‚   â”œâ”€â”€ ThemeService.ts # Ø®Ø¯Ù…Ø© Ø§Ù„Ø«ÙŠÙ…Ø§Øª
â”‚   â”‚   â”‚   â””â”€â”€ SettingsService.ts
â”‚   â”‚   â”œâ”€â”€ ui/                 # Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
â”‚   â”‚   â”‚   â”œâ”€â”€ Toast.ts        # Ø±Ø³Ø§Ø¦Ù„ Toast
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.ts        # Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
â”‚   â”‚   â”‚   â””â”€â”€ Menu.ts         # Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
â”‚   â”‚   â””â”€â”€ helpers/            # Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
â”‚   â”œâ”€â”€ shared/                 # Ù…ÙƒÙˆÙ†Ø§Øª Ù…Ø´ØªØ±ÙƒØ© (Ø®Ø§Ø¯Ù… + Ø¹Ù…ÙŠÙ„)
â”‚   â”‚   â”œâ”€â”€ components/         # Ù…ÙƒÙˆÙ†Ø§Øª SSR
â”‚   â”‚   â”‚   â”œâ”€â”€ navigation.ts   # Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„
â”‚   â”‚   â”‚   â”œâ”€â”€ login-modal.ts  # Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
â”‚   â”‚   â”‚   â””â”€â”€ footer.ts       # Ø§Ù„ØªØ°ÙŠÙŠÙ„
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â””â”€â”€ layout.ts       # Ù‚Ø§Ù„Ø¨ HTML Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
â”‚   â”œâ”€â”€ modules/                # ÙˆØ­Ø¯Ø§Øª API ÙˆÙ…Ø³Ø§Ø±Ø§Øª
â”‚   â”‚   â”œâ”€â”€ api/                # Ù†Ù‚Ø§Ø· API
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/           # Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
â”‚   â”‚   â”‚   â”œâ”€â”€ users/          # Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
â”‚   â”‚   â”‚   â”œâ”€â”€ competitions/   # Ø§Ù„Ù…Ù†Ø§ÙØ³Ø§Øª
â”‚   â”‚   â”‚   â”œâ”€â”€ categories/     # Ø§Ù„ÙØ¦Ø§Øª
â”‚   â”‚   â”‚   â”œâ”€â”€ countries/      # Ø§Ù„Ø¯ÙˆÙ„
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications/  # Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
â”‚   â”‚   â”‚   â”œâ”€â”€ messages/       # Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
â”‚   â”‚   â”‚   â”œâ”€â”€ likes/          # Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª
â”‚   â”‚   â”‚   â”œâ”€â”€ reports/        # Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
â”‚   â”‚   â”‚   â”œâ”€â”€ search/         # Ø§Ù„Ø¨Ø­Ø«
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/       # Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
â”‚   â”‚   â”‚   â”œâ”€â”€ schedule/       # Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/          # Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
â”‚   â”‚   â”‚   â””â”€â”€ jitsi/          # Ø¨Ø« Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
â”‚   â”‚   â””â”€â”€ pages/              # ØµÙØ­Ø§Øª HTML
â”‚   â”œâ”€â”€ controllers/            # Ù…ØªØ­ÙƒÙ…Ø§Øª API
â”‚   â”œâ”€â”€ models/                 # Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
â”‚   â”œâ”€â”€ lib/                    # Ù…ÙƒØªØ¨Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
â”‚   â”‚   â”œâ”€â”€ oauth/              # Ù…Ø²ÙˆØ¯ÙŠ OAuth
â”‚   â”‚   â””â”€â”€ services/           # Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù…
â”‚   â”œâ”€â”€ middleware/             # Ø¨Ø±Ù…Ø¬ÙŠØ§Øª ÙˆØ³ÙŠØ·Ø©
â”‚   â””â”€â”€ routes/                 # Ù…Ø³Ø§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
â”œâ”€â”€ public/                     # Ù…Ù„ÙØ§Øª Ø«Ø§Ø¨ØªØ©
â”‚   â””â”€â”€ static/                 # CSS, Ø®Ø·ÙˆØ·, ØµÙˆØ±
â”œâ”€â”€ dist/                       # Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡
â””â”€â”€ migrations/                 # Ù‡Ø¬Ø±Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
```

---

## âš ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø­ÙŠÙˆÙŠØ© - ÙŠØ¬Ø¨ Ø§ØªØ¨Ø§Ø¹Ù‡Ø§

### 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ (Dual Build System)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     npm run build                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. build:css    â”‚ Tailwind â†’ public/static/styles.css        â”‚
â”‚ 2. build:client â”‚ esbuild: src/client/index.ts â†’ app.js      â”‚
â”‚ 3. vite build   â”‚ Vite: src/main.ts â†’ _worker.js (SSR)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš ï¸ ØªØ­Ø°ÙŠØ±**: 
- `src/client/` ÙŠÙØ¨Ù†Ù‰ Ø¨Ù€ **esbuild** Ø¥Ù„Ù‰ `dist/static/app.js`
- `src/main.ts` + `src/shared/` ÙŠÙØ¨Ù†Ù‰ Ø¨Ù€ **Vite** Ø¥Ù„Ù‰ `dist/_worker.js`
- Ù…Ù„ÙØ§Øª `src/shared/components/` ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ **Ø§Ù„Ø®Ø§Ø¯Ù… ÙÙ‚Ø·** (SSR)
- Ù…Ù„ÙØ§Øª `src/client/` ØªØ¹Ù…Ù„ ÙÙŠ **Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·**

---

### 2. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø© (i18n)

#### Ø¨Ù†ÙŠØ© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
```typescript
// âŒ Ø®Ø·Ø£: Ù…ÙØ§ØªÙŠØ­ Ù…Ø³Ø·Ø­Ø© Ø¨Ù€ underscore
t('auth_login_success', lang)    // Ù‡Ø°Ù‡ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙƒÙ…ÙØ§ØªÙŠØ­ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ ar.ts/en.ts

// âœ… ØµØ­ÙŠØ­: Ù…ÙØ§ØªÙŠØ­ Ù…ØªØ¯Ø§Ø®Ù„Ø© Ø¨Ù€ Ù†Ù‚Ø·Ø©
t('auth.login_success', lang)    // ØªØ¨Ø­Ø« Ø¹Ù† translations[lang].auth.login_success

// âœ… ØµØ­ÙŠØ­: Ù…ÙØ§ØªÙŠØ­ Ù…Ø¨Ø§Ø´Ø±Ø© (Ù…Ø³Ø·Ø­Ø©)
t('login', lang)                  // ØªØ¨Ø­Ø« Ø¹Ù† translations[lang].login
```

#### âš ï¸ ØªØ­Ø°ÙŠØ± Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹:
Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© (`en.ts`, `ar.ts`) ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ **Ù†ÙˆØ¹ÙŠÙ† Ù…Ù† Ø§Ù„Ù…ÙØ§ØªÙŠØ­**:
1. **Ù…ÙØ§ØªÙŠØ­ Ù…Ø³Ø·Ø­Ø©** (Flat): `auth_login_success`, `auth_connection_failed` 
2. **Ù…ÙØ§ØªÙŠØ­ Ù…ØªØ¯Ø§Ø®Ù„Ø©** (Nested): `auth: { login_success: ... }`

**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©**:
- Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ø³Ø·Ø­Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ØªØ§Ø±ÙŠØ®ÙŠØ§Ù‹ Ù„Ù„Ù€ API/Server
- Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© Ø£ÙØ¶ÙŠÙØª Ù„Ù„Ù€ Client-side
- Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… `t('x.y.z', lang)` ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ ÙƒØ§Ø¦Ù† Ù…ØªØ¯Ø§Ø®Ù„:
  ```typescript
  // ÙÙŠ en.ts/ar.ts
  x: {
    y: {
      z: 'Ø§Ù„Ù‚ÙŠÙ…Ø©'
    }
  }
  ```

#### Ù…ÙƒØ§Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª:
| Ø§Ù„Ù…ÙƒØ§Ù† | Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ | Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª |
|--------|----------|-----------|
| `src/client/*` | `import { t } from '../../i18n'` | ÙŠØ³ØªØ®Ø¯Ù… `State.lang` |
| `src/shared/*` | `import { translations, getUILanguage } from '../../i18n'` | ÙŠØ³ØªØ®Ø¯Ù… `translations[getUILanguage(lang)]` Ù…Ø¨Ø§Ø´Ø±Ø© |
| `src/main.ts` | `import { translations, ... } from './i18n'` | SSR ÙÙŠ Ø§Ù„ØµÙØ­Ø§Øª |

---

### 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (State Management)

#### Ø£ÙˆÙ„ÙˆÙŠØ§Øª ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„Ø¨Ù„Ø¯:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Language/Country Priority Chain                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. User Database Settings (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¯Ø®ÙˆÙ„Ù‡)   â”‚
â”‚ 2. URL Parameter (?lang=ar)                                  â”‚
â”‚ 3. Cookie (lang=ar, country=SA)                             â”‚
â”‚ 4. Browser/Device Settings (navigator.language)             â”‚
â”‚ 5. Default Fallback (en / US)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ù…Ù„Ù `State.ts`**:
- ÙŠØ¯ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø§Ù„Ø¬Ù„Ø³Ø©ØŒ Ø§Ù„Ù„ØºØ©ØŒ Ø§Ù„Ø¨Ù„Ø¯ØŒ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…
- **ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù…** `State.getLanguage()` Ùˆ `State.getCountry()` Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©

---

### 4. Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Shared Components)

#### âš ï¸ ØªØ­Ø°ÙŠØ± Ø­Ø§Ø³Ù…:
```
src/shared/components/navigation.ts
src/shared/components/login-modal.ts
src/shared/components/footer.ts
```

Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„ÙØ§Øª **ØªÙÙ†ÙØ° Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…** (SSR) ÙˆØªÙØ±Ø³Ù„ ÙƒÙ€ HTML Ù„Ù„Ù…ØªØµÙØ­.

**Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©**:
- ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ³ØªØ®Ø¯Ù… `translations[getUILanguage(lang)]` Ù…Ø¨Ø§Ø´Ø±Ø©
- Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… `t()` function Ù‡Ù†Ø§ Ù„Ø£Ù†Ù‡Ø§ client-side
- The onclick handlers call **global window functions** like:
  - `toggleCountryMenu()` â†’ defined in `src/client/index.ts`
  - `showLoginModal()` â†’ defined in `src/client/index.ts`
  - `filterCountries()` â†’ defined in `src/client/index.ts`

#### ØªØ¯ÙÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Country Menu Flow                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. HTML ÙŠÙÙˆÙ„Ù‘Ø¯ ÙÙŠ navigation.ts (SSR)                        â”‚
â”‚    â””â”€ <div id="countriesList"></div> ÙØ§Ø±Øº                   â”‚
â”‚                                                              â”‚
â”‚ 2. Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø£Ø±Ø¶ÙŠØ©:                           â”‚
â”‚    â””â”€ toggleCountryMenu() ÙÙŠ Menu.ts                        â”‚
â”‚                                                              â”‚
â”‚ 3. Menu.toggleCountry() ÙŠØ³ØªØ¯Ø¹ÙŠ:                             â”‚
â”‚    â””â”€ window.filterCountries('') ÙÙŠ client/index.ts         â”‚
â”‚                                                              â”‚
â”‚ 4. CountryFunctions.renderList() ÙŠÙ…Ù„Ø£ countriesList         â”‚
â”‚    â””â”€ ÙŠØ³ØªØ®Ø¯Ù… getCountriesList() Ù…Ù† countries.ts             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø§Ù…Ø© (Global Functions)

ÙÙŠ `src/client/index.ts`:
```typescript
// Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ§Ù„ ØªÙØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ window Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ onclick
window.showLoginModal = () => Modal.showLogin();
window.toggleCountryMenu = () => Menu.toggleCountry();
window.filterCountries = (query: string) => CountryFunctions.renderList(query);
window.selectCountry = (code: string) => CountryFunctions.select(code);
// ... ÙˆØºÙŠØ±Ù‡Ø§
```

---

### 6. Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (AuthService)

#### Ø±Ø³Ø§Ø¦Ù„ Toast:
```typescript
// âœ… ØµØ­ÙŠØ­ - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØ§ØªÙŠØ­ Ù…ØªØ¯Ø§Ø®Ù„Ø©
Toast.success(t('auth.login_success', State.lang));
Toast.info(t('auth.logout_success', State.lang));
Toast.warning(t('client.toast.allow_popups', State.lang));

// âœ… ØµØ­ÙŠØ­ - Ø§Ù„Ù€ Modal ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù€ API
Modal.showAuthMessage(data.error || t('auth_invalid_credentials', State.lang), 'error');
```

---

## ğŸ”§ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨Ù†Ø§Ø¡

```bash
# ØªØ·ÙˆÙŠØ± Ù…Ø­Ù„ÙŠ
npm run dev:sandbox

# Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù†ØªØ§Ø¬
npm run build

# Ù†Ø´Ø± Ø¹Ù„Ù‰ Cloudflare
npm run deploy
```

---

## ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© ØªØ¯Ù‚ÙŠÙ‚ Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„

- [ ] Ù‡Ù„ Ø£ÙÙ‡Ù… Ø£ÙŠÙ† Ø³ÙŠÙÙ†ÙØ° Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŸ (Ø®Ø§Ø¯Ù… Ø£Ù… Ù…ØªØµÙØ­)
- [ ] Ù‡Ù„ Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„ØµÙŠØºØ© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ±Ø¬Ù…Ø©ØŸ
- [ ] Ù‡Ù„ Ø£Ø¶ÙØª Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ ÙƒÙ„Ø§ Ù…Ù„ÙÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø© (en.ts + ar.ts)ØŸ
- [ ] Ù‡Ù„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù…Ø¹Ø±Ù‘ÙØ© ÙÙŠ `window` Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ onclickØŸ
- [ ] Ù‡Ù„ Ø±Ø§Ø¬Ø¹Øª ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ

---

## ğŸš¨ Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø© ÙŠØ¬Ø¨ ØªØ¬Ù†Ø¨Ù‡Ø§

1. **Ø§Ø³ØªØ®Ø¯Ø§Ù… `t()` ÙÙŠ Ù…ÙƒÙˆÙ†Ø§Øª SSR** â†’ Ø§Ø³ØªØ®Ø¯Ù… `translations[getUILanguage(lang)]` Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù†Ù‡Ø§
2. **Ø¥Ø¶Ø§ÙØ© Ù…ÙØªØ§Ø­ ØªØ±Ø¬Ù…Ø© Ø¨ØµÙŠØºØ© Ø®Ø§Ø·Ø¦Ø©** â†’ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ØµÙŠØºØ© (Ù†Ù‚Ø·Ø© vs underscore)
3. **Ù†Ø³ÙŠØ§Ù† ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„** â†’ ÙŠØ¬Ø¨ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ `filterCountries('')` Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
4. **Ø¹Ø¯Ù… ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù…Ø¹Ø§Ù‹** â†’ Ø£ÙŠ Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØ¶Ø§Ù ÙÙŠ en.ts Ùˆ ar.ts

---

*Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 2025-12-12*
